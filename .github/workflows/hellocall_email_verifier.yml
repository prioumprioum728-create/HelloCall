name: HelloCall Email Verifier

on:
  workflow_dispatch:      # Manual trigger
  push:
    branches: [ main ]   # Optional automatic trigger

jobs:
  send-verification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Generate Unique Verification Code
        id: gen_code
        run: |
          # Generate a random 6-character alphanumeric code
          CODE=$(openssl rand -hex 3)
          echo "VERIFICATION_CODE=$CODE" >> $GITHUB_ENV
          echo "Generated verification code: $CODE"

      - name: Send Verification Email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.example.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "HelloCall Email Verification"
          to: "user@example.com"  # Recipient email
          from: "HelloCall AI <noreply@hellocall.com>"
          body: |
            Hello! Your HelloCall verification code is:

            ${{ env.VERIFICATION_CODE }}

            Please enter this code in your app or workflow to confirm your email.

      - name: Log Verification Code (optional)
        run: echo "Code sent: ${{ env.VERIFICATION_CODE }}"
